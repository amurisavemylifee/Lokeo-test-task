<template>
  <div class="header">
    <h1>Пропуск</h1>
    <svg width="19" height="19" viewBox="0 0 19 19">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.61774 0.616741C8.73788 -0.20558 10.2622 -0.20558 11.3823 0.616741L12.4837 1.42536C12.6655 1.55882 12.8769 1.64638 13.0998 1.68055L14.4505 1.88763C15.8239 2.09821 16.9018 3.17604 17.1124 4.54956L17.3195 5.9002C17.3537 6.12312 17.4412 6.33448 17.5747 6.51627L18.3832 7.61774C19.2056 8.73788 19.2056 10.2622 18.3832 11.3823L17.5747 12.4837C17.4412 12.6655 17.3537 12.8769 17.3195 13.0998L17.1124 14.4505C16.9018 15.8239 15.8239 16.9018 14.4505 17.1124L13.0998 17.3195C12.8769 17.3537 12.6655 17.4412 12.4837 17.5747L11.3823 18.3832C10.2622 19.2056 8.73788 19.2056 7.61774 18.3832L6.51627 17.5747C6.33448 17.4412 6.12312 17.3537 5.9002 17.3195L4.54956 17.1124C3.17604 16.9018 2.09821 15.8239 1.88763 14.4505L1.68055 13.0998C1.64638 12.8769 1.55882 12.6655 1.42536 12.4837L0.616741 11.3823C-0.20558 10.2622 -0.20558 8.73788 0.616741 7.61774L1.42536 6.51627C1.55882 6.33448 1.64638 6.12312 1.68055 5.9002L1.88763 4.54956C2.09821 3.17604 3.17604 2.09821 4.54956 1.88763L5.9002 1.68055C6.12312 1.64638 6.33448 1.55882 6.51627 1.42536L7.61774 0.616741ZM10.3282 2.05261C9.83534 1.6908 9.16469 1.6908 8.67185 2.05261L7.57038 2.86123C7.15719 3.16456 6.6768 3.36355 6.17013 3.44123L4.8195 3.6483C4.21518 3.74095 3.74095 4.21518 3.6483 4.8195L3.44123 6.17013C3.36355 6.6768 3.16456 7.15719 2.86123 7.57038L2.05261 8.67185C1.6908 9.16469 1.6908 9.83534 2.05261 10.3282L2.86123 11.4296C3.16456 11.8428 3.36355 12.3232 3.44123 12.8299L3.6483 14.1806C3.74095 14.7849 4.21518 15.259 4.8195 15.3517L6.17013 15.5588C6.6768 15.6364 7.15719 15.8355 7.5704 16.1389L8.67185 16.9474C9.16469 17.3093 9.83534 17.3093 10.3282 16.9474L11.4296 16.1389C11.8428 15.8355 12.3232 15.6364 12.8299 15.5588L14.1806 15.3517C14.7849 15.259 15.259 14.7849 15.3517 14.1806L15.5588 12.8299C15.6364 12.3232 15.8355 11.8428 16.1389 11.4296L16.9474 10.3282C17.3093 9.83534 17.3093 9.16469 16.9474 8.67185L16.1389 7.5704C15.8355 7.15719 15.6364 6.6768 15.5588 6.17013L15.3517 4.8195C15.259 4.21518 14.7849 3.74095 14.1806 3.6483L12.8299 3.44123C12.3232 3.36355 11.8428 3.16456 11.4296 2.86123L10.3282 2.05261ZM10.6875 13.0625C10.6875 13.7184 10.1559 14.25 9.50001 14.25C8.84418 14.25 8.31251 13.7184 8.31251 13.0625C8.31251 12.4067 8.84418 11.875 9.50001 11.875C10.1559 11.875 10.6875 12.4067 10.6875 13.0625ZM8.21853 7.22644C8.31415 7.03521 8.44358 6.87109 8.62105 6.75278C8.79294 6.63818 9.06216 6.53126 9.50006 6.53126C9.83227 6.53126 10.1566 6.63405 10.3758 6.79845C10.5713 6.94501 10.6876 7.13699 10.6876 7.42189C10.6876 7.63162 10.6391 7.73516 10.5959 7.79993C10.5421 7.88072 10.4492 7.97006 10.2677 8.09103C10.177 8.1515 10.0794 8.21027 9.96027 8.28177L9.95299 8.28614L9.95296 8.28615C9.84171 8.35291 9.71031 8.43175 9.58119 8.51783C9.31729 8.69378 9.002 8.93847 8.75899 9.30303C8.48617 9.71232 8.5968 10.2653 9.00609 10.5381C9.41537 10.8109 9.96832 10.7003 10.2411 10.291C10.295 10.2102 10.3879 10.1208 10.5693 9.99987C10.66 9.9394 10.7576 9.88063 10.8768 9.80914L10.8842 9.80472L10.8842 9.80468C10.9954 9.73794 11.1268 9.65914 11.2558 9.57309C11.5197 9.39716 11.835 9.15252 12.0781 8.78799C12.3317 8.40744 12.4688 7.95434 12.4688 7.42189C12.4688 6.51928 12.0408 5.82064 11.4446 5.37345C10.8721 4.94409 10.1575 4.75001 9.50006 4.75001C8.75046 4.75001 8.12906 4.93996 7.63299 5.27068C7.14249 5.59768 6.8266 6.02731 6.62533 6.42984C6.40536 6.86978 6.58369 7.40476 7.02363 7.62474C7.46359 7.84471 7.99856 7.66638 8.21853 7.22644Z"
        fill="#78B62C"
      />
    </svg>
  </div>
  <div class="selects-grid">
    <app-select
      label="Тип проезжающего"
      v-model="typeOfPassing"
      :options="[
        'Житель',
        'Гость',
        'Грузовой транспорт',
        'Доставка',
        'Службы',
        'Подрядчик',
        'Сотрудник',
        'Партнер',
        'Лид',
      ]"
    ></app-select>
    <app-select
      label="Срочность"
      v-model="urgencyType"
      :options="['Постоянный', 'Временный']"
    ></app-select>
    <app-select
      label="Тип пропуска"
      v-model="typeOfPass"
      :options="['RFID', 'ГРЗ', 'QR', 'ПИН', 'Обычный']"
    ></app-select>
  </div>
  <app-input
    placeholder="E28011052000745AFC160A59"
    label="Идентификатор RFID"
    style="width: 455px; margin-bottom: 33px"
    v-model="passValue"
    v-if="typeOfPass === 'RFID'"
  ></app-input>
  <div class="buttons-container">
    <app-button @click="$router.push('/passes')">Отменить</app-button>
    <app-button
      @click="saveHandler"
      :disabled="ID === '' || (passValue === '' && typeOfPass === 'RFID')"
      >Сохранить</app-button
    >
  </div>
  <div class="pass-info">
    <div class="dashed-block">
      <h3>Ваш пропуск</h3>
      <div class="info-item">
        КПП<span v-for="item in checkpoints">{{ item }}</span>
      </div>
      <div class="info-item">
        Поселок и участок<span>{{ region }}</span>
      </div>
      <div class="info-item">
        Лицо<span>{{ person }}</span>
      </div>
      <div class="info-item">
        Автомобиль<span>{{ transport }}</span>
      </div>
      <div class="info-item">
        <span class="pass-info-title">Пропуск</span>
        <div class="pass-info-item">
          Тип проезжающего: <span>{{ typeOfPassing }}</span>
        </div>
        <div class="pass-info-item">
          Тип пропуска: <span>{{ typeOfPass }}</span>
        </div>
        <div class="pass-info-item">
          Срочность: <span>{{ urgencyType }}</span>
        </div>
        <div class="pass-info-item">
          Продукт, по которому предоставляется пропуск:
          <span>{{ product }}</span>
        </div>
        <div class="pass-info-item">
          Идетификатор: <span>{{ ID }}</span>
        </div>
        <img
          class="qr-code"
          :src="`http://qrcoder.ru/code/?${ID}&4&0`"
          v-if="ID && typeOfPass === 'QR'"
        />
      </div>
    </div>
  </div>
</template>

<script>
import AppSelect from "../components/AppSelect.vue";
import AppButton from "../components/AppButton.vue";
import AppInput from "../components/AppInput.vue";
import { onMounted, ref } from "vue";
import { usePassesStore } from "../store/usePassesStore";
import { useModalStore } from "../store/useModalStore";
import { useRouter } from "vue-router";
export default {
  components: {
    AppSelect,
    AppButton,
    AppInput,
  },
  setup() {
    const router = useRouter();
    const { createPass } = usePassesStore();
    const { createModal } = useModalStore();
    const checkpoints = ref(["КПП 8 Меньшино"]);
    const region = ref("Меньшино");
    const person = ref("Игорь Васильевич Иванов");
    const transport = ref("Т 400 ТХ 71");
    const typeOfPassing = ref("Житель");
    const typeOfPass = ref("Обычный");
    const urgencyType = ref("Постоянный");
    const product = ref("Обслуживание участков");
    const ID = ref("");
    const passValue = ref("");

    function saveHandler() {
      createPass({
        checkpoints,
        person,
        transport,
        typeOfPass,
        passValue: passValue != "" ? passValue : ID.value,
        ID,
        region,
        typeOfPassing,
        urgencyType,
        product,
      });
      createModal("Пропуск успешно создан!");
      router.push("/passes");
    }

    function idGenerator() {
      let nums = "0123456789";
      let chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      let password = "";
      for (let i = 0; i <= 2; i++) {
        let randomNumber = Math.floor(Math.random() * nums.length);
        password += nums.substring(randomNumber, randomNumber + 1);
      }
      for (let i = 0; i <= 2; i++) {
        let randomNumber = Math.floor(Math.random() * chars.length);
        password += chars.substring(randomNumber, randomNumber + 1);
      }
      for (let i = 0; i <= 1; i++) {
        let randomNumber = Math.floor(Math.random() * nums.length);
        password += nums.substring(randomNumber, randomNumber + 1);
      }
      ID.value = password;
    }
    onMounted(() => {
      setTimeout(() => {
        idGenerator();
      }, 10000);
    });
    return {
      saveHandler,
      checkpoints,
      region,
      person,
      transport,
      typeOfPassing,
      typeOfPass,
      urgencyType,
      product,
      ID,
      passValue,
    };
  },
};
</script>

<style lang="scss" scoped>
.buttons-container {
  position: absolute;
  bottom: 60px;

  button + button {
    margin-left: 40px;
  }
}
.qr-code {
  width: 250px;
  height: 406px;
  padding-top: 156px;
}
.selects-grid {
  display: grid;
  grid-template-rows: 63px;
  grid-template-columns: 455px 455px;
  grid-column-gap: 8px;
  grid-row-gap: 38px;
  padding-bottom: 33px;
}
.header {
  display: flex;
  align-items: center;
  padding-bottom: 45px;
  h1 {
    font-weight: 900;
    font-size: 30px;
    line-height: 35px;
    color: #2a341d;
    margin-right: 9px;
  }
}
.pass-info {
  position: absolute;
  right: 0;
  top: 0;
  background: #ffffff;
  border-radius: 0px 25px 25px 0px;
  padding: 10px;
  box-shadow: -15px 0px 46px 0px hsla(0, 0%, 7%, 0.5);
  width: 336px;
  height: 100%;
}
.dashed-block {
  border: 1px dashed #78b62c;
  border-radius: 0px 25px 25px 0px;
  height: 100%;
  h3 {
    padding: 35px 0 26px 32px;
    font-weight: 900;
    font-size: 20px;
    line-height: 23px;
    color: #2a341d;
  }
  .info-item {
    padding: 0 0 13px 32px;
    display: flex;
    flex-direction: column;
    font-weight: 700;
    font-size: 16px;
    line-height: 19px;
    color: #2a341d;
    span {
      font-weight: 400;
    }
    .pass-info-title {
      font-weight: 700;
      color: #2a341d;
      padding-bottom: 10px;
    }
    .pass-info-item {
      color: #c3c7cf;
      span {
        color: #2a341d;
      }
    }
  }
}
</style>